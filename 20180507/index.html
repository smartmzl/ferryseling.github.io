<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:等线;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"\@等线";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:等线;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"页眉 字符";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	layout-grid-mode:char;
	border:none;
	padding:0cm;
	font-size:9.0pt;
	font-family:等线;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"页脚 字符";
	margin:0cm;
	margin-bottom:.0001pt;
	layout-grid-mode:char;
	font-size:9.0pt;
	font-family:等线;}
p.MsoDate, li.MsoDate, div.MsoDate
	{mso-style-link:"日期 字符";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:5.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:等线;}
a:link, span.MsoHyperlink
	{color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
span.MsoPlaceholderText
	{color:gray;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:21.0pt;
	font-size:10.5pt;
	font-family:等线;}
span.a
	{mso-style-name:"日期 字符";
	mso-style-link:日期;}
p.MyContent, li.MyContent, div.MyContent
	{mso-style-name:MyContent;
	mso-style-link:"MyContent 字符";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:7.8pt;
	margin-left:0cm;
	text-align:justify;
	text-justify:inter-ideograph;
	line-height:16.0pt;
	font-size:10.5pt;
	font-family:等线;}
span.MyContent0
	{mso-style-name:"MyContent 字符";
	mso-style-link:MyContent;}
span.a0
	{mso-style-name:"页眉 字符";
	mso-style-link:页眉;}
span.a1
	{mso-style-name:"页脚 字符";
	mso-style-link:页脚;}
.MsoChpDefault
	{font-family:等线;}
 /* Page Definitions */
 @page WordSection1
	{size:595.3pt 841.9pt;
	margin:36.0pt 36.0pt 36.0pt 36.0pt;
	layout-grid:15.6pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=ZH-CN link="#0563C1" vlink="#954F72" style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:16.0pt'>《图解密码技术》<span lang=EN-US>1-6</span>章汇报</span></p>

<p class=MsoNormal align=center style='text-align:center'>学生：孟则霖</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US>2018</span>年<span
lang=EN-US>5</span>月<span lang=EN-US>7</span>日</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US>&nbsp;</span></p>

<p class=MyContent><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>拿到书的第一件事，当然是把译者序里面的恺撒密码破译啦，得到的明文是：<span
lang=EN-US>”If you want to learn more about cryptography. I recommend an online
course instructed by professor &nbsp;Dan Boneh from Stanford University. Just
search cryptography at coursera.org.”</span>。似乎得到了译者的真传。</p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>这一次学习的主要目的是<b>扫盲</b>，把密码学中最为基础的知识巩固扎实。</p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><span
lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><b>一、第一章笔记</b></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>单向散列函数：用于保证<b>完整性</b>而非机密性，如<span lang=EN-US>MD5\SHA256</span>。又称校验码、指纹、摘要。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>密码学家的工具箱：对称密码、公钥密码、单向散列函数、消息认证码、数字签名、伪随机数生成器。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>信息安全所面临的威胁分为四种：窃听、篡改、伪装、<b>否认</b>。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>隐写术的现代应用：数字水印就应用了这种原理，将版权或购买者信息嵌入到文件中，但不能实现加密。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>不要使用保密的加密算法，这种做法一般称为<b>隐蔽式安全性（<span lang=EN-US>security by
obsecurity</span>）</b>，因为算法早晚会公诸于世、开发高强度的密码算法是非常困难的。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>社会工程学攻击：绕开破译密码，通过对受害者心理弱点，本能反应，好奇心，信任，贪婪等心理陷阱进行分析并且推理然后达到欺骗的目的（获取对方的信任）。</p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><b>二、第二章笔记</b></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b>密钥空间</b>：一种密码能够使用的所有密钥的集合。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b>密钥加密密钥</b>：<span lang=EN-US>Enigma</span>中的每日密码是用来加密密钥的密码。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>标准化技术的出现，使得算法不再是秘密，也能被继续开发、研究和利用。但它的安全性也丝毫没有降低，因为密码算法和密钥是分开的。</p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><b>三、第三章笔记</b></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>对异或运算的四种解读：<span lang=EN-US>(1)</span>相同为<span lang=EN-US>0</span>，不同为<span
lang=EN-US>1</span>；<span lang=EN-US>(2)</span>加法进位；<span lang=EN-US>(3)</span>翻转操作；
<span lang=EN-US>(4)</span>奇数偶数相加。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:11.5pt'><img
width=95 height=42 src="index.files/image001.png"></span>，其中<span lang=EN-US>A</span>为明文，<span
lang=EN-US>B</span>为密钥，则<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:4.0pt'><img
width=160 height=21 src="index.files/image002.png"></span>。同时这种加密方法可以应用到图像的加密上，则<span
lang=EN-US>B</span>就对应了一个图像蒙版。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>一次性密码本无法破译，即是暴力破解也不行，无论计算机多快，可以瞬间遍历完成整个密钥空间，也无法确定那个解密的结果是正确的，因为可能会的到很多看似正确的明文（所有的排列组合都可能出现）。它的不可破性的严格证明是香农提出的。注意一次性密码本的密钥长度不应小于明文长度。当然这种密码的问题也很多，就不多写了。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>分组密码：以分组为单位进行处理的密码成为分组密码（<span lang=EN-US>block cipher</span>）。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>DES</span>就是分组密码的一种。理解<span lang=EN-US>DES</span>加密算法的重点在于理解<span
lang=EN-US>Feistel</span>网络，而这已经在《密码故事》的报告中说明了。我们知道无论<span lang=EN-US>f</span>多复杂都可以正确加解密。书上这句话说的很好：“<span
lang=EN-US>Feistel</span>网络实际上就是从密码算法中抽取出‘密码的本质部分’并将其封装成一个轮函数”。这种密码另外还有一个特点：加密和解密可以用<b>完全相同的结构</b>来实现。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:0cm;line-height:16.0pt'>而轮函数<span
lang=EN-US>f</span>和子密钥的实现方法在此书中同样没有详细的解答，详见下方网址：</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:0cm;line-height:16.0pt'><span lang=EN-US>https://en.wikipedia.org/wiki/Data_Encryption_Standard#The_Feistel_(F)_function</span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b>差分分析</b>是一种针对分组密码的分析方法，思路是：“改变一部分明文并分析密文如何随之改变”。<b>线性分析</b>的思路是：“将明文和密文的对应比特进行<span
lang=EN-US>XOR</span>并计算其结果为<span lang=EN-US>0</span>的概率。“随机性较好的密文概率应该为<span
lang=EN-US>0.5</span>，因而如果大量偏离<span lang=EN-US>0.5</span>的话，就可以借此获得一些信息。这两种分析方法都可以对<span
lang=EN-US>DES</span>构成威胁。暴力破解也可以作为破解<span lang=EN-US>DES</span>的一种辅助方式。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>三重<span lang=EN-US>DES</span>事实上是对加密过程进行三次<span lang=EN-US>DES</span>处理，分别是加密→解密→加密，而这三次操作均适用不同的三个密钥，因而密码长度达到了<span
lang=EN-US>168bit</span>。这种密钥的解密过程也很简单，就不多说了。<span lang=EN-US>3DES</span>是兼容<span
lang=EN-US>DES</span>的（三次操作都是用同一密钥）。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:0cm;line-height:16.0pt'>另外，如果第一步第三步使用同一密钥，那就是<span
lang=EN-US>DES-EDE2</span>加密方式，其中<span lang=EN-US>EDE</span>表示加密→解密→加密的过程。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span lang=EN-US>AES</span>算法</b>的选拔过程了解一下，很有意思。现在使用的<span
lang=EN-US>AES</span>是由<span lang=EN-US>Joan Daemen</span>和<span lang=EN-US>Vincent
Rijmen</span>提出的<span lang=EN-US>Rijndael</span>算法。它使用<span lang=EN-US>SPN</span>结构（<span
lang=EN-US>SubstitutionCpermutation network</span>）。<span lang=EN-US>AES</span>的密钥长度固定为<span
lang=EN-US>128bit</span>、<span lang=EN-US>192bit</span>或<span lang=EN-US>256bit</span>，分组长度为<span
lang=EN-US>128bit</span>，并存放在一个<span lang=EN-US>4*4</span>的矩阵中，每个矩阵存放<span
lang=EN-US>1</span>个字节<span lang=EN-US>=2</span>个十六进制数<span lang=EN-US>=8bit</span>，这个矩阵成为<span
lang=EN-US>State</span>。目前仅仅考虑密钥长度<span lang=EN-US>128</span>位的情况，这样密钥可以表示成<span
lang=EN-US>4*4</span>的矩阵，每一个元素存放<span lang=EN-US>1</span>个字节。算法分为以下步骤：</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>a)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>SubBytes</span>：使用<span lang=EN-US>S-Box</span>（替换矩阵）替换字节的值，取一个字节的前四位和后四位分别作为纵坐标和横坐标在<span
lang=EN-US>S-Box</span>中找到替换值，类似简单替换密码。其中<span lang=EN-US>S-Box</span>是一个<span
lang=EN-US>16*16</span>的矩阵常量，可以在网上查到。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>b)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>ShiftRows</span>：取上一步的结果，并把每一行都平移不同的距离。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>c)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>MixColumns</span>：取上一步的结果，把每一个列向量乘以一个<span
lang=EN-US>MC</span>矩阵，得到一个列向量，并以此替换以前的列向量。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>d)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>AddRoundKey</span>：取上一步的结果，把它与轮密钥进行异或操作，得到最终结果。</p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:7.8pt;
margin-left:21.0pt;text-indent:21.0pt;line-height:16.0pt'>以上操作是一轮过程，一般来说需要进行<span
lang=EN-US>10</span>轮操作。过程中，一共需要生成<span lang=EN-US>10</span>个轮密钥，下面来看看轮密钥是怎么生成的，我们以第一轮的轮密钥举例：</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>a)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>第一步：拿出初始密钥的<b>第四列</b><span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=28 height=21 src="index.files/image003.png"></span>，进行纵向的平移、再进行<span
lang=EN-US>S-Box</span>替换得到<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=27 height=21 src="index.files/image004.png"></span>，最后将<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=27 height=21 src="index.files/image004.png"></span>与密钥的<b>第一列</b><span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=28 height=21 src="index.files/image005.png"></span>和<span lang=EN-US>Rcon</span>矩阵的第一列<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=15 height=21 src="index.files/image006.png"></span>进行异或，得到第一轮密钥的第一列<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=28 height=21 src="index.files/image007.png"></span>。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>b)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>第二步：初始密钥的<b>第二列</b><span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=28 height=21 src="index.files/image008.png"></span>与第一轮轮密钥的第一列<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=28 height=21 src="index.files/image007.png"></span>，得到第一轮密钥的第二列<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:3.0pt'><img
width=28 height=21 src="index.files/image009.png"></span>，依此类推，直到把第一轮的密钥计算完毕。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:0cm;line-height:16.0pt'>其中<span
lang=EN-US>Rcon </span>是一个<span lang=EN-US>10*4</span>字节的矩阵，这是一个常数。并且每一轮的算法都是一样的。虽然过程比较麻烦，但是思路很简单，没有涉及很复杂的东西。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>书上说<span lang=EN-US>Rijndael</span>的算法有着严谨的数学表达，在这里先不展开。</p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><b>四、第四章笔记</b></p>

<p class=MsoNormal style='margin-bottom:7.8pt;text-indent:21.0pt;line-height:
16.0pt'><b>这一章中的思想很总要，特别是每种模式的图解都非常好，英文名称和简称以及图示必须要透彻理解，最好要牢记。特别是在现在的学习阶段，最好是不是能默写一下图解。</b></p>

<p class=MsoNormal style='margin-bottom:7.8pt;text-indent:21.0pt;line-height:
16.0pt'><span lang=EN-US>https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation</span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>分组密码（<span lang=EN-US>block cipher</span>）：每次都只能处理一定长度的一块数据；<b>流密码</b>（<span
lang=EN-US>stream cipher</span>）：对数据流进行连续处理的一类密码算法（明文需要和密钥流结合）。<span
lang=EN-US>DES/3DES/AES</span>都属于分组密码，只有一次性密码本属于流密码。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>分组密码的模式：对长明文加密的迭代方法。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>五种分组模式：<span lang=EN-US>ECB/CBC/CTS/CFB/OFB/CTR</span>。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>ECB</span>（<span lang=EN-US>Electronic CodeBook</span>）：将<b>明文分组</b>加密后的结果将直接成为<b>密文分组</b>。也就是说明文分组和密文分组是<b>一一对应</b>的关系。总结一下<span
lang=EN-US>ECB</span>的特点：每个明文分组各自独立进行加解密。书上例举了一个通过对调几个分组来篡改信息的例子，事实上还可以对分组进行删除、复制等操作。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>CBC</span>（<span lang=EN-US>Cipher Block Chaining</span>）：加密过程从<b>第一组明文</b>开始，将<b>明文分组</b>与前一个<b>密文分组</b>进行<span
lang=EN-US>XOR</span>，再进行加密，而第一个明文分组与初始化向量<span lang=EN-US>IV</span>进行异或。解密过程从<b>第一组密文</b>开始，解密后再与<span
lang=EN-US>IV</span>求异或得<b>第一组明文</b>，<b>第二组密文</b>解密后与<b>第一组密文</b>求异或得到<b>第二组明文</b>。这样一来，前后顺序就非常重要，无法对调、替换或删除。其中初始化向量<span
lang=EN-US>IV</span>需要随机生成，并作为格外的输入（其实也就是密钥的一部分了，因为这个<span lang=EN-US>IV</span>是不能泄漏或预测。）。对<span
lang=EN-US>CBC</span>进行破解的思路是，对<span lang=EN-US>IV</span>中的<span lang=EN-US>bit</span>进行翻转，则明文也会有<span
lang=EN-US>bit</span>被翻转。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:0cm;line-height:16.0pt'>另外关于<span
lang=EN-US>IV</span>在不同的具体算法中实现方式也是不一样的。<span lang=EN-US>SSL</span>就是使用这种模式实现的。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>填充部分（<span lang=EN-US>Padding</span>）：当明文长度不为分组长度的整数倍时，需要在最后一个分组中填充一些数据凑满一个分组长度。注意理解填充提示攻击。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>CTS</span>（<span lang=EN-US>Cipher Text Stealing</span>）：使用最后一个分组的前一个密文分组数据来进行填充。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>CFB</span>（<span lang=EN-US>Cipher FeedBack</span>）：<b>前一个密文分组</b>会被送回到<b>密码算法</b>的输入端。明文分组和密文分组之间并没有经过加密这一步骤。与<span
lang=EN-US>CBC</span>的区别在于：<span lang=EN-US>CFB</span>是将上一个分组或<span lang=EN-US>IV</span>加密后，再与明文分组进行<span
lang=EN-US>XOR</span>得到密文，而没有直接对明文分组进行加密。这里的<span lang=EN-US>IV</span>与<span
lang=EN-US>CBC</span>类似。这种模式实际上是使用分组密码来实现<b>流密码</b>。这里的加密算法就相当于用来生成密钥流的伪随机数生成器，<span
lang=EN-US>IV</span>就相当于种子（每次加密时都要生成），但是<span lang=EN-US>IV</span>在应用中应该怎么传输呢？维基当中的图片更清楚。</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
width=359 height=145 id="图片 1" src="index.files/image010.png"
alt="CFB encryption.svg"></span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:0cm;line-height:16.0pt'><span lang=EN-US>https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_Feedback_(CFB)</span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>密钥流（<span lang=EN-US>Key Stream</span>）：是一串<b>伪随机字符</b>与<b>明文信息</b>结合而生成的加密的比特信息流。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:0cm;line-height:16.0pt'><span lang=EN-US><a
href="https://en.wikipedia.org/wiki/Keystream">https://en.wikipedia.org/wiki/Keystream</a></span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>10.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>针对<span
lang=EN-US>CFB</span>的<b>重放攻击</b>（<span lang=EN-US>Replay Attack</span>）：是指攻击者发送一个目的主机已接收过的包，来达到欺骗系统的目的，主要用于身份认证过程，破坏认证的正确性。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>11.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>OFB</span>（<span lang=EN-US>Output FeedBack</span>）：这是指密码算法的输出会反馈到密码算法的输入中。简答来说，首先对<span
lang=EN-US>IV</span>进行加密得到<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:4.0pt'><img
width=14 height=21 src="index.files/image011.png"></span>，得到的结果与<b>明文分组<span
lang=EN-US>1</span></b>进行异或；再对上一步的到的<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:4.0pt'><img
width=14 height=21 src="index.files/image011.png"></span>进行加密，再与<b>明文分组<span
lang=EN-US>2</span></b>进行异或；依次类推。这里每一步的<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:4.0pt'><img
width=16 height=21 src="index.files/image012.png"></span>都是流密钥，流密钥的生成和<span
lang=EN-US>XOR</span>操作可以并行。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>12.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>CTR</span>（<span lang=EN-US>CounTeR</span>）：通过将<b>逐次累加计数器</b>进行加密来生成密钥流的流密码。具体做法是：每次加密都会生成一个计数器的初始值<span
lang=EN-US>nonce</span>，而每一组加密完成后，都会对其<span lang=EN-US>+1</span>。它的弱点与<span
lang=EN-US>OFB</span>类似，在密文中对比特翻转，也会引起明文中比特的翻转。<span lang=EN-US>GCM</span>是一种对<span
lang=EN-US>CTR</span>的优化方案，可以增加“认证”方案，避免上述安全性问题。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>13.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>关于这几种加密方式的快速记忆：</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>a)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>ECB</span>：电子密码本，最基本的方式，很好记。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>b)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>CBC</span>：密文分组链接，上一组密文和下一组明文<span lang=EN-US>XOR</span>。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>c)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>CFB</span>：密文反馈，上一组密文作为<b>反馈</b>再进行加密。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>d)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>OFB</span>：输出反馈，加密结果作为<b>反馈</b>再进行加密。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:42.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>e)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>CTR</span>：计数器，每一份组计数加一。</p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><b>五、第五章笔记</b></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>密钥配送问题最简单的解决方案：<b>事先共享、<span lang=EN-US>KDC</span>、<span
lang=EN-US>Diffie-Hellman</span>密钥交换、公钥密码</b>。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>KDC</span>，<span lang=EN-US>Key Distribution
Center</span>，密钥分配中心：用户间需要点对点通讯时，此机构负责生成一个伪随机密钥通信密钥发送给通讯双方（使用各自的密钥加密），双方使用各自的密钥解密后得到本次通信用的密钥。<span
lang=EN-US>Diffie-Hellman</span>密钥交换：《密码故事》中已经提及。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>公钥密码的两大问题：公钥认证和速度过慢。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>在这一章学习的基本数学包括：时钟运算（加减乘除、乘方、对数）。<span lang=EN-US>RSA</span>实际上就是利用到了<b>离散对数</b>。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>RSA</span>生成密钥对的过程：<span lang=EN-US>N</span>→<span
lang=EN-US>L</span>→<span lang=EN-US>E</span>→<span lang=EN-US>D</span>。其中<span
lang=EN-US>N</span>是两个大质数<span lang=EN-US>p</span>和<span lang=EN-US>q</span>的乘积，<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:4.0pt'><img
width=129 height=21 src="index.files/image013.png"></span>，再找到满足<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:4.0pt'><img
width=82 height=21 src="index.files/image014.png"></span>的<span lang=EN-US>E</span>（<span
lang=EN-US>E</span>和<span lang=EN-US>L</span>互质），最后找到满足<span
lang=EN-US style='font-size:10.5pt;font-family:等线;position:relative;top:4.0pt'><img
width=120 height=21 src="index.files/image015.png"></span>的<span lang=EN-US>D</span>。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>最小公倍数（<span lang=EN-US>LCM</span>）的计算：最小公倍数<span lang=EN-US>=</span>两整数的乘积<span
lang=EN-US>/</span>最大公约数。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>最大公约数（<span lang=EN-US>GCD</span>）的计算：辗转相除法（欧几里得定理）。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>RSA</span>破解方案：<span
lang=EN-US>1</span>对<span lang=EN-US>N</span>质因数分解反求<span lang=EN-US>p</span>、<span
lang=EN-US>q</span>。<span
lang=EN-US>2</span>通过密文，使用离散对数算法，反求明文。<span
lang=EN-US>3</span>通过伪随机数算法推测<span lang=EN-US>p</span>和<span lang=EN-US>q</span>。<span
lang=EN-US>1</span>、<span lang=EN-US>2</span>均无有效方法。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>RSA</span>的攻击方方案：<span
lang=EN-US>1</span>中间人攻击（抵御方案：认证）。<span
lang=EN-US>2</span>选择密文攻击（抵御方案：<span lang=EN-US>RSA-OAEP</span>）。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>10.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>一些数据：应用场景下，<span
lang=EN-US>N</span>长度若为<span lang=EN-US>2048</span>，<span lang=EN-US>p</span>、<span
lang=EN-US>q</span>长度一般为</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>11.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>问题：判断质数的<b>费马测试</b>和<b>米勒・拉宾</b>测试？</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>12.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>其他公钥密码：<span
lang=EN-US>ElGamal</span>方式、<span lang=EN-US>Rabin</span>方式、椭圆曲线密码。</p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><b>六、第六章笔记</b></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>混合密码系统（<span lang=EN-US>hybrid cryptosystem</span>）：非对称算法解决对称密钥的配送问题。使用对称算法和会话密钥加密消息明文，再使用非对称算法加密会话密钥。</p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
7.8pt;margin-left:21.0pt;text-indent:-21.0pt;line-height:16.0pt'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>高强度的混合密码系统：强大的伪随机数生成算法、对称和非对称密钥长度的平衡。</p>

<p class=MsoNormal style='margin-bottom:7.8pt;line-height:16.0pt'><b>七、关于<span
lang=EN-US>SSL/TLS</span></b></p>

<p class=MyContent><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>我现在通过<span
lang=EN-US>WireShark</span>对<span lang=EN-US>SSL/TLS</span>的通信过程进行一次分析，我现在以百度官网为例。</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=649 height=365 id="图片 8" src="index.files/image016.jpg"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>明显，百度官网使用的是<span
lang=EN-US>TLS1.2</span>。由于请求太多，我们仅对本地端口为<span lang=EN-US>8982</span>的<span
lang=EN-US>HTTPS</span>请求进行分析，因此我们将过滤器条件设置如下：</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=295 height=73 id="图片 10" src="index.files/image017.jpg"></span></p>

<p class=MyContent><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>得到如下过滤结果：</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=632 height=273 id="图片 11" src="index.files/image018.jpg"></span></p>

<p class=MyContent><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>我们现在来进行分析，其中<span
lang=EN-US>No.xxxxx</span>代表某一个请求编号，如<span lang=EN-US>No.49037</span>上图的<span
lang=EN-US>49037</span>号请求。某个过程可能包括多个请求，编号可能不连续，但一定升序排列。</p>

<p class=MyContent><b>第一步：<span lang=EN-US>Hello</span>（<span lang=EN-US>No.49037~No.49559</span>）</b></p>

<p class=MyContent><b><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b>下方左、右图分别为“<span
lang=EN-US>ClientHello</span>”和“<span lang=EN-US>ServerHello</span>”。</p>

<p class=MyContent><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>在“<span
lang=EN-US>ClientHello</span>”中浏览器指定了客户端所有支持的加密方式（<span lang=EN-US>Cipher Suite</span>），并发送给服务器，当服务器收到请求后，从客户端的<span
lang=EN-US>CipherSuite</span>中筛选出可用的某一个，并使用将筛选结果“<span lang=EN-US>ServerHello</span>”返回给客户端。可见现在浏览器已经普遍支持椭圆曲线加密算法了。</p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img
border=0 width=261 height=238 id="图片 14" src="index.files/image019.jpg">&nbsp;<img
border=0 width=376 height=237 id="图片 15" src="index.files/image020.jpg"></span></p>

<p class=MyContent><b>第二步：<span lang=EN-US>Certificate</span>（<span lang=EN-US>No.49625</span>）</b></p>

<p class=MyContent style='text-indent:21.0pt'>下方为“<span lang=EN-US>Certificate</span>”报文，内容主要是用于<span
lang=EN-US>RSA</span>的公钥证书。可见，这个报文中包含了两个证书，这两个证书在格式上是统一的，而长度不同，由于证书其他信息都很明确，我们这里主要看看<span
lang=EN-US>extensions</span>字段。</p>

<p class=MsoNormal><span lang=EN-US><img border=0 width=700 height=239
id="组合 18" src="index.files/image021.png"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>因而，我们来比较一下“<span
lang=EN-US>extensions</span>”字段，左侧为第一个，右侧为第二个（红框表示自己特有的）：</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=210 height=99 id="图片 19" src="index.files/image022.png"><img
border=0 width=265 height=100 id="图片 21" src="index.files/image023.jpg"></span></p>

<p class=MyContent><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>比较可以发现，两个证书不同，但都是<span
lang=EN-US>X.509 v3</span>标准的，关于这些<span lang=EN-US>extensions</span>的字段信息可以参考下表：</p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>KeyUsage</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>指明证书中公钥的作用。</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>https://tools.ietf.org/html/rfc3280#page-28</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>AuthorityInfoAccessSyntax&nbsp;
  </span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>指明如何访问<span lang=EN-US>CA</span>服务。</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>https://tools.ietf.org/html/rfc3280#page-45</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>certificatePolicies</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>指明策略信息。</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>https://tools.ietf.org/html/rfc3280#page-30</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>BasicConstraints</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>指明了使用此证书的基本约束。</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>https://tools.ietf.org/html/rfc3280#page-35</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>subjectAltName</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>证书主体的别名。</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>https://tools.ietf.org/html/rfc3280#page-22</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>extKeyUsage</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>用于补充或是替换<span lang=EN-US>KeyUsage</span>。</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>https://tools.ietf.org/html/rfc3280#page-40</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>SubjectKeyIdentifier</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>一个散列值，用于验证含有特定公钥的证书。</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>https://tools.ietf.org/html/rfc3280#page-26</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>authorityKeyIdentifier</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>一个散列值，用于验证与私约证书相关的公钥。</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>https://tools.ietf.org/html/rfc3280#page-25</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>SignedCertificateTimestampList</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>&nbsp;</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width=170 valign=top style='width:127.35pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>&nbsp;</span></p>
  </td>
  <td width=271 valign=top style='width:203.4pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt'>&nbsp;</span></p>
  </td>
  <td width=177 valign=top style='width:132.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:6.5pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MyContent>另外通过发布者信息可以看出两个证书的作用是不一样的：</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=404 height=113 id="图片 25" src="index.files/image024.png"></span></p>

<p class=MyContent><b>第三步： <span lang=EN-US>ServerKeyExchange</span>（<span
lang=EN-US>No.49632</span>）</b></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>这里使用<span
lang=EN-US>Diffie-Hellman</span>交换方式交换公钥信息，用于传递具体的加密参数。此处加密算法使用的是椭圆曲线<span
lang=EN-US>SECP256R1</span>，而签名算法使用的<span lang=EN-US>RSA</span>。</p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=425 height=208 id="图片 28" src="index.files/image025.jpg"></span></p>

<p class=MyContent><b>第四步：<span lang=EN-US>ServerHelloDone</span>（<span
lang=EN-US>No.49633</span>）</b></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=352 height=121 id="图片 27" src="index.files/image026.jpg"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>此时通信的初始化完成。</p>

<p class=MyContent><b>第五步：<span lang=EN-US>ClientKeyExchange</span>、<span
lang=EN-US>ChangeCipherSpec</span>和<span lang=EN-US>EncryptedHandshakeMessage</span>（<span
lang=EN-US>No.49793</span>）</b></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=514 height=218 id="图片 29" src="index.files/image027.jpg"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>这一步的三个操作，都是<b>由客户端向服务器</b>提出的。<span
lang=EN-US>ClientKeyExchange</span>通过<span lang=EN-US>Diffie-Hellman</span>将<span
lang=EN-US>Pre-master Secret</span>加密后（使用<span lang=EN-US>Certificate</span>或<span
lang=EN-US>ServerKeyExchange</span>中的公钥）传送给服务器，这是由客户端生成的伪随机数，服务器根据这个<span
lang=EN-US>PMS</span>生成主密码；</p>

<p class=MyContent><b>第六步：<span lang=EN-US>NewSessionTicket</span>、<span
lang=EN-US>ChangeCipherSpec</span>、<a name="_Hlk513466387"><span lang=EN-US>EncryptedHandshakeMessage</span></a>（<span
lang=EN-US>No.50144~50182</span>）</b></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=513 height=47 id="图片 31" src="index.files/image028.jpg"></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>这一步的三个操作，都是<b>由服务器向客户端</b>提出的。<span
lang=EN-US>ChangeCipherSpec</span>变更密码加密模式，此消息发送后，就开始使用协商一致的密码和加密算法进行通信了。<span
lang=EN-US>EncryptedHandshakeMessage</span>则是用于保证中间没人篡改报文以及秘钥的正确性。</p>

</div>

</body>

</html>
